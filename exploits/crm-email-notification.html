<html>
    <head>
        <title>Keeping tabs on a client CRM</title>
        <link rel="stylesheet" href="/styles.css">
    </head>
    <body>
        <div class="page-center-text">
            <h1>Keeping tabs on a client CRM</h1>
            <h2>Context</h2>
            <p>
                In my last role, we would manage CRM for a lot of clients, and sometimes a client would push an email template to ActiveCampaign without letting us know, 
                and in all the work we were doing, we wouldn't think to check. This would result in a delayed, sometimes time-sensitive, email.
            </p>
            <br>
            <h2>Solution</h2>
            <p>
                We needed something that would let us know when a new email was pushed through, it had to let us all know and not get lost in already busy inboxes. 
                I decided to use the Google chat feature since it supported webhooks in group chats, I could send a message through easily and everyone would receive an instant ping.
            </p>
            <p>
                I wrote a PHP script hosted on our cPanel server, it worked like this :
            </p>
            <ol>
                <li>The script was called by a crontab</li>
                <li>It sent an API call to ActiveCampaign to see the templates</li>
                <li>A local copy of the templates was kept on the server, it was compared to content from the API, if they were the same, nothing happened</li>
                <li>If they were different, the API would save a copy of the new content to the server to compare next time</li>
                <li>Once the new content was saved, a webhook was sent through to the Google chat, pinging everyone online that a new template had arrived</li>
            </ol>
            <p>
                The code worked as intended, sending pings whenever the content we were waiting on had arrived. 
                However, there was a case I hadn't considered.
            </p>
            <p>
                It's not unheard of for supplement companies to change their ingredients, meaning sometimes we would have to change email templates to match the new recipe. 
                As a result, when we were mass updating the templates, we were getting pings every few minutes from the notification bot. Very annoying.
            </p>
            <p>
                As a workaround, I created a mechanism which could turn the script off easily when it was needed. Here's how it worked :
            </p>
            <ol>
                <li>The script is run by cron</li>
                <li>It sends a request to a particular URL on our website</li>
                <li>Depending on the current SEO settings for the URL, the URL would return a 302 or a 404</li>
                <li>If the script got a 302, it would carry on as normal, if it didn't, it would stop.</li>
            </ol>
            <p>
                This was a very hacky fix, but for the few times we needed it switched off, it was working.
            </p>
            <p>
                Later on, I made some improvements to the script. Instead of downloading the content of the templates, it would read the metadata to see the number of templates and compare it to the number of templates from the last API call. 
                This prevented the script sending messages if a template was altered, but would still send if a new one was added.
            </p>
            <br>
            <h2>Conclusion</h2>
            <p>
                While it may seem a bit overkill at first, this script was incredibly useful when used to help communication between a busy agency and a busy client.
            </p>
            <p>
                The script continued to operate and work until the client migrated CRM, <a href="/exploits/crm-migration-webhook.html">read about that here</a>.
            </p>
    </body>
</html>